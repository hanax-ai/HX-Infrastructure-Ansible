
# {{ ansible_managed }}
# Kerberos Configuration for HX Domain Join

[libdefaults]
    default_realm = {{ hx_ad_realm_upper }}
    ticket_lifetime = {{ hx_krb5_ticket_lifetime }}
    renew_lifetime = {{ hx_krb5_renew_lifetime }}
    forwardable = {{ hx_krb5_forwardable | ternary('true', 'false') }}
    rdns = false
    pkinit_anchors = FILE:/etc/ssl/certs/ca-certificates.crt
    
{% if hx_domain_require_encryption %}
    default_tgs_enctypes = aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96
    default_tkt_enctypes = aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96
    permitted_enctypes = aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96
{% endif %}

[realms]
    {{ hx_ad_realm_upper }} = {
{% if hx_ad_domain_controller %}
        kdc = {{ hx_ad_domain_controller }}
        admin_server = {{ hx_ad_domain_controller }}
{% else %}
        kdc = {{ hx_ad_domain_lower }}
        admin_server = {{ hx_ad_domain_lower }}
{% endif %}
        default_domain = {{ hx_ad_domain_lower }}
    }

[domain_realm]
    .{{ hx_ad_domain_lower }} = {{ hx_ad_realm_upper }}
    {{ hx_ad_domain_lower }} = {{ hx_ad_realm_upper }}

[logging]
    kdc = FILE:/var/log/krb5kdc.log
    admin_server = FILE:/var/log/kadmin.log
    default = FILE:/var/log/krb5lib.log

[appdefaults]
    pam = {
        debug = false
        ticket_lifetime = {{ hx_krb5_ticket_lifetime }}
        renew_lifetime = {{ hx_krb5_renew_lifetime }}
        forwardable = {{ hx_krb5_forwardable | ternary('true', 'false') }}
        krb4_convert = false
    }
