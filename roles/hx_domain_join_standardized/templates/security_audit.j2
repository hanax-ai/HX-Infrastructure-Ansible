
# {{ ansible_managed }}
# HX Domain Join Security Audit Report
# Generated: {{ ansible_date_time.iso8601 }}

## Domain Configuration
Domain: {{ hx_ad_domain }}
Realm: {{ hx_ad_realm }}
Computer Name: {{ hx_ad_computer_name }}
Computer FQDN: {{ hx_ad_computer_fqdn }}

## Security Settings
Security Enabled: {{ hx_domain_security_enabled | ternary('Yes', 'No') }}
Strict Validation: {{ hx_domain_strict_validation | ternary('Yes', 'No') }}
Require Encryption: {{ hx_domain_require_encryption | ternary('Yes', 'No') }}
Verify Certificates: {{ hx_domain_verify_certificates | ternary('Yes', 'No') }}

## Authentication Configuration
SSSD Enabled: {{ hx_sssd_enabled | ternary('Yes', 'No') }}
Kerberos Enabled: {{ hx_krb5_enabled | ternary('Yes', 'No') }}
Cache Credentials: {{ hx_sssd_cache_credentials | ternary('Yes', 'No') }}

## File Permissions
SSSD Config: {{ hx_sssd_conf_path }} (600)
Kerberos Config: {{ hx_krb5_conf_path }} (644)
Realmd Config: {{ hx_realmd_conf_path }} (644)

## Encryption Settings
{% if hx_domain_require_encryption %}
Kerberos Encryption Types:
- AES256-CTS-HMAC-SHA1-96
- AES128-CTS-HMAC-SHA1-96

LDAP Security:
- Start TLS: Enabled
- Certificate Validation: {{ hx_domain_verify_certificates | ternary('Required', 'Optional') }}
{% else %}
Encryption: Not enforced (WARNING)
{% endif %}

## Access Control
{% if hx_sudo_enabled %}
Sudo Access Enabled: Yes
Sudo Groups: {{ hx_sudo_groups | join(', ') if hx_sudo_groups else 'None' }}
Sudo Users: {{ hx_sudo_users | join(', ') if hx_sudo_users else 'None' }}
{% else %}
Sudo Access: Disabled
{% endif %}

## Home Directory Configuration
Home Directory Creation: {{ hx_home_dir_enabled | ternary('Enabled', 'Disabled') }}
Base Directory: {{ hx_home_dir_base }}
Default Shell: {{ hx_login_shell }}
Umask: {{ hx_home_dir_umask }}

## Validation Results
{% if hx_ldaps_cert_check is defined %}
LDAPS Certificate Check: {{ hx_ldaps_cert_check.rc == 0 | ternary('PASSED', 'FAILED') }}
{% if hx_ldaps_cert_check.rc != 0 %}
Error: {{ hx_ldaps_cert_check.stderr | default('Unknown error') }}
{% endif %}
{% endif %}

{% if hx_weak_auth_check is defined %}
Weak Authentication Check: {{ hx_weak_auth_check.rc == 0 | ternary('PASSED', 'ISSUES DETECTED') }}
{% if hx_weak_auth_check.rc != 0 %}
Issues: {{ hx_weak_auth_check.stdout }}
{% endif %}
{% endif %}

## Recommendations
{% if not hx_domain_security_enabled %}
- Enable domain security features for production environments
{% endif %}
{% if not hx_domain_require_encryption %}
- Enable encryption requirements for enhanced security
{% endif %}
{% if not hx_domain_verify_certificates %}
- Enable certificate verification to prevent MITM attacks
{% endif %}
{% if hx_sssd_cache_credentials %}
- Consider disabling credential caching in high-security environments
{% endif %}
{% if hx_sssd_enumerate_users %}
- Disable user enumeration to reduce information disclosure
{% endif %}

## Compliance Notes
- File permissions follow security best practices
- Strong encryption algorithms are configured
- Certificate validation is {{ hx_domain_verify_certificates | ternary('enabled', 'disabled') }}
- Audit logging is {{ hx_domain_audit_logging_enabled | ternary('enabled', 'disabled') }}

---
Report generated by HX Domain Join Role v{{ hx_domain_join_version }}
Ansible managed: {{ ansible_managed }}
