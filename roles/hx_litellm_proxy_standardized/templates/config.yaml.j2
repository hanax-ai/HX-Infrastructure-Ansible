# LiteLLM Proxy Configuration
# Generated by Ansible - HX Infrastructure

model_list:
{% for provider in hx_litellm_providers %}
  - model_name: {{ provider.model_name }}
    litellm_params:
{% for key, value in provider.litellm_params.items() %}
      {{ key }}: {{ value | to_json }}
{% endfor %}
{% if provider.model_info is defined %}
    model_info:
{% for key, value in provider.model_info.items() %}
      {{ key }}: {{ value | to_json }}
{% endfor %}
{% endif %}
{% endfor %}

{% if hx_litellm_custom_models %}
# Custom Models
{% for model in hx_litellm_custom_models %}
  - model_name: {{ model.model_name }}
    litellm_params:
{% for key, value in model.litellm_params.items() %}
      {{ key }}: {{ value | to_json }}
{% endfor %}
{% if model.model_info is defined %}
    model_info:
{% for key, value in model.model_info.items() %}
      {{ key }}: {{ value | to_json }}
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}

# General Settings
general_settings:
  master_key: {{ hx_litellm_master_key | to_json }}
  {% if hx_litellm_enable_database %}
  database_url: {{ hx_litellm_database_url | to_json }}
  {% endif %}
  {% if hx_litellm_enable_redis %}
  redis_host: {{ hx_litellm_redis_host | to_json }}
  redis_port: {{ hx_litellm_redis_port }}
  redis_password: {{ hx_litellm_redis_password | default('') | to_json }}
  {% endif %}
  
  # Caching
  {% if hx_litellm_enable_caching %}
  cache: true
  cache_type: {{ hx_litellm_cache_type | to_json }}
  cache_ttl: {{ hx_litellm_cache_ttl }}
  {% endif %}
  
  # Rate Limiting
  {% if hx_litellm_enable_rate_limiting %}
  rate_limit_strategy: "fixed_window"
  {% endif %}
  
  # Load Balancing
  {% if hx_litellm_enable_load_balancing %}
  routing_strategy: {{ hx_litellm_load_balancing_strategy | to_json }}
  {% endif %}
  
  # Logging
  set_verbose: {{ hx_litellm_enable_detailed_logging | lower }}
  json_logs: {{ (hx_litellm_log_format == 'json') | lower }}
  
  # Security
  {% if hx_litellm_enable_cors %}
  cors_origins: {{ hx_litellm_cors_origins | to_json }}
  {% endif %}
  
  # Health Check
  {% if hx_litellm_enable_health_check %}
  health_check_interval: {{ hx_litellm_health_check_interval }}
  {% endif %}
  
  # Budget Management
  max_budget: {{ hx_litellm_max_budget }}
  budget_duration: "1mo"
  
  # Fallbacks
  {% if hx_litellm_enable_failover %}
  fallbacks: {{ hx_litellm_fallback_models | to_json }}
  {% endif %}

# Router Settings
router_settings:
  routing_strategy: {{ hx_litellm_load_balancing_strategy | to_json }}
  model_group_alias: {}
  retry_attempts: {{ hx_litellm_retry_attempts }}
  retry_delay: {{ hx_litellm_retry_delay }}
  timeout: {{ hx_litellm_timeout }}

{% if hx_litellm_api_keys %}
# API Keys
litellm_settings:
  api_keys:
{% for api_key in hx_litellm_api_keys %}
    - key: {{ api_key.key | to_json }}
      models: {{ api_key.models | to_json }}
      max_budget: {{ api_key.max_budget | default(10.0) }}
      user_id: {{ api_key.user_id | to_json }}
{% endfor %}
{% endif %}

{% if hx_litellm_rate_limits %}
# Rate Limits
rate_limits:
{% for limit in hx_litellm_rate_limits %}
  - model: {{ limit.model | to_json }}
    rpm: {{ limit.rpm }}
    tpm: {{ limit.tpm }}
{% endfor %}
{% endif %}
