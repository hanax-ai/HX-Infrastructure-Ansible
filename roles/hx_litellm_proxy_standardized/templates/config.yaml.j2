
# LiteLLM Proxy Configuration
# Generated by Ansible - HX LiteLLM Proxy Standardized Role
# {{ ansible_managed }}

model_list:
{% for provider_name, provider_config in hx_litellm_providers.items() %}
{% if provider_config.enabled | default(false) %}
{% for model in provider_config.models %}
  - model_name: {{ model.name }}
    litellm_params:
      model: {{ model.litellm_params.model }}
      api_key: {{ model.litellm_params.api_key }}
{% if model.litellm_params.api_base is defined %}
      api_base: {{ model.litellm_params.api_base }}
{% endif %}
{% if model.litellm_params.api_version is defined %}
      api_version: {{ model.litellm_params.api_version }}
{% endif %}
{% if model.litellm_params.max_tokens is defined %}
      max_tokens: {{ model.litellm_params.max_tokens }}
{% endif %}
{% if model.litellm_params.temperature is defined %}
      temperature: {{ model.litellm_params.temperature }}
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}

# Router settings
router_settings:
  routing_strategy: {{ hx_litellm_routing_strategy }}
  model_group_alias: {}
  fallbacks: {{ hx_litellm_fallback_models | to_json }}
  context_window_fallbacks: {{ hx_litellm_model_fallbacks | to_json }}
  retry_after: {{ hx_litellm_retry_delay }}
  allowed_fails: {{ hx_litellm_retry_attempts }}
  cooldown_time: 30

# General settings
general_settings:
  master_key: {{ hx_litellm_master_key }}
  database_url: {{ hx_litellm_database_url if hx_litellm_database_enabled else 'null' }}
  
{% if hx_litellm_caching_enabled %}
  # Caching configuration
  cache:
    type: {{ hx_litellm_cache_type }}
{% if hx_litellm_cache_type == "redis" %}
    host: {{ hx_litellm_redis_host }}
    port: {{ hx_litellm_redis_port }}
{% if hx_litellm_redis_password %}
    password: {{ hx_litellm_redis_password }}
{% endif %}
{% endif %}
    ttl: {{ hx_litellm_cache_ttl }}
{% endif %}

  # Rate limiting
{% if hx_litellm_rate_limiting_enabled %}
  max_budget: {{ hx_litellm_max_budget }}
  budget_duration: "1mo"
  
  # Global rate limits
  rpm: {{ hx_litellm_max_requests_per_minute }}
  tpm: 1000000
  max_requests_per_hour: {{ hx_litellm_max_requests_per_hour }}
  max_requests_per_day: {{ hx_litellm_max_requests_per_day }}
{% endif %}

  # Logging
  set_verbose: {{ 'true' if hx_litellm_log_level == 'DEBUG' else 'false' }}
  json_logs: {{ 'true' if hx_litellm_log_format == 'json' else 'false' }}
  
  # Performance settings
  num_retries: {{ hx_litellm_retry_attempts }}
  request_timeout: {{ hx_litellm_request_timeout }}
  max_budget: {{ hx_litellm_max_budget }}
  
  # Security settings
  enforce_user_param: true
  store_model_in_db: {{ hx_litellm_database_enabled | lower }}
  
{% if hx_litellm_custom_config %}
  # Custom configuration
{{ hx_litellm_custom_config | to_nice_yaml | indent(2, first=False) }}
{% endif %}

# Environment settings
environment_variables:
  LITELLM_LOG: {{ hx_litellm_log_level }}
  LITELLM_DROP_PARAMS: "true"
  LITELLM_SET_VERBOSE: "{{ 'true' if hx_litellm_log_level == 'DEBUG' else 'false' }}"
{% for key, value in hx_litellm_env_vars.items() %}
  {{ key }}: {{ value }}
{% endfor %}
