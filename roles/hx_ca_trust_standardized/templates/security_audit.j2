
# {{ ansible_managed }}
# HX CA Trust Security Audit Report
# Generated: {{ ansible_date_time.iso8601 }}

## Certificate Information
Certificate File: {{ hx_ca_cert_full_path }}
Certificate Name: {{ hx_ca_root_ca_filename }}
Source CA Host: {{ hx_ca_host }}
Source Path: {{ hx_ca_root_ca_path_on_ca }}

## File Permissions
Owner: {{ hx_ca_cert_owner }}
Group: {{ hx_ca_cert_group }}
Mode: {{ hx_ca_cert_mode }}
Strict Permissions: {{ hx_ca_strict_permissions | ternary('Enabled', 'Disabled') }}

## Security Settings
Security Enabled: {{ hx_ca_security_enabled | ternary('Yes', 'No') }}
Chain Verification: {{ hx_ca_verify_chain | ternary('Enabled', 'Disabled') }}
Expected SHA256: {{ hx_ca_expected_sha256 | default('Not specified') }}
{% if hx_ca_actual_fingerprint is defined %}
Actual SHA256: {{ hx_ca_actual_fingerprint.stdout }}
{% endif %}

## Certificate Details
{% if hx_ca_cert_info is defined %}
{{ hx_ca_cert_info.stdout }}
{% endif %}

## Chain Verification
{% if hx_ca_chain_verify is defined %}
Chain Verification Result: {{ hx_ca_chain_verify.rc == 0 | ternary('PASSED', 'FAILED') }}
{% if hx_ca_chain_verify.rc != 0 %}
Error: {{ hx_ca_chain_verify.stderr }}
{% endif %}
{% endif %}

## Certificate Expiry
{% if hx_ca_expiry_check is defined %}
Expiry Check: {{ hx_ca_expiry_check.stdout }}
{% endif %}

## SAN Validation
{% if hx_ca_san_check_targets | length > 0 %}
SAN Check Targets: {{ hx_ca_san_check_targets | length }}
{% for target in hx_ca_san_check_targets %}
- {{ target.name | default(target.address) }}: {{ target.address }}:{{ target.port | default(443) }}
{% endfor %}
{% else %}
SAN Check Targets: None configured
{% endif %}

## Backup Configuration
Backup Enabled: {{ hx_ca_backup_enabled | ternary('Yes', 'No') }}
Backup Directory: {{ hx_ca_backup_dir }}

## Monitoring Configuration
Monitoring Enabled: {{ hx_ca_monitoring_enabled | ternary('Yes', 'No') }}
Audit Logging: {{ hx_ca_audit_logging_enabled | ternary('Yes', 'No') }}
Log Directory: {{ hx_ca_log_dir }}

## Recommendations
{% if not hx_ca_security_enabled %}
- Enable security features for production environments
{% endif %}
{% if not hx_ca_verify_chain %}
- Enable certificate chain verification
{% endif %}
{% if hx_ca_expected_sha256 | length == 0 %}
- Configure expected SHA256 fingerprint for additional security
{% endif %}
{% if not hx_ca_backup_enabled %}
- Enable certificate backups for disaster recovery
{% endif %}
{% if not hx_ca_monitoring_enabled %}
- Enable certificate monitoring for proactive management
{% endif %}

---
Report generated by HX CA Trust Role v{{ hx_ca_trust_version }}
Ansible managed: {{ ansible_managed }}
