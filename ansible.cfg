# HX-Infrastructure Ansible Configuration
# Optimized for ansible-core 2.19.2 and production use
# Environment: dev-test.hana-x.ai (15 servers)
# Administrative User: agent0

[defaults]
# ============================================================================
# INVENTORY AND ENVIRONMENT CONFIGURATION
# ============================================================================
# Multi-environment inventory support
inventory = inventories/dev/hosts.yml
# Alternative inventories can be specified via -i flag or ANSIBLE_INVENTORY
# inventories/test/hosts.yml, inventories/prod/hosts.yml

# Host and connection settings
# host_key_checking = False  # REMOVED: Security risk - bypasses SSH host key verification
remote_user = agent0
ask_pass = False
ask_sudo_pass = False

# ============================================================================
# PERFORMANCE OPTIMIZATION
# ============================================================================
# Parallel execution - optimized for 15-server environment
forks = 15
serial = 5
poll_interval = 10
timeout = 30
command_timeout = 30
connect_timeout = 30

# Fact gathering optimization
gathering = smart
fact_caching = jsonfile
fact_caching_connection = ~/.cache/ansible/facts
fact_caching_timeout = 3600
gather_subset = !facter,!ohai
gather_timeout = 30

# Task execution optimization
strategy = linear
strategy_plugins = ~/.ansible/plugins/strategy:/usr/share/ansible/plugins/strategy
hash_behaviour = replace
# jinja2_extensions = jinja2.ext.do,jinja2.ext.i18n  # REMOVED: Deprecated in ansible-core 2.23

# ============================================================================
# SECURITY AND AUTHENTICATION
# ============================================================================
# Vault configuration for secrets management - Environment-based approach
# Use environment variables for secure vault password management
# Set ANSIBLE_VAULT_PASSWORD_FILE or use vault_identity_list with env vars
vault_identity_list = dev@${ANSIBLE_VAULT_DEV_PASSWORD_FILE:-/dev/null},test@${ANSIBLE_VAULT_TEST_PASSWORD_FILE:-/dev/null},prod@${ANSIBLE_VAULT_PROD_PASSWORD_FILE:-/dev/null}
vault_encrypt_identity = dev
# Enforce vault ID matching for security
vault_id_match = True

# Privilege escalation settings
become = True
become_method = sudo
become_user = root
become_ask_pass = False
become_exe = sudo
become_flags = -H -S -n

# Security settings for ansible-core 2.19.2
allow_world_readable_tmpfiles = False
allow_broken_conditionals = False
allow_embedded_templates = False

# Suppress deprecation warnings for cleaner output
deprecation_warnings = False

# ============================================================================
# OUTPUT AND LOGGING CONFIGURATION
# ============================================================================
# Enhanced output formatting
stdout_callback = yaml
stderr_callback = yaml
callback_whitelist = timer,profile_tasks,profile_roles,yaml
bin_ansible_callbacks = True
display_skipped_hosts = False
display_ok_hosts = True
display_failed_stderr = True
show_custom_stats = True

# Logging and audit trail
log_path = logs/ansible.log
syslog_facility = LOG_LOCAL0
no_log = False
no_target_syslog = False

# ============================================================================
# ERROR HANDLING AND RELIABILITY
# ============================================================================
# Retry and error handling
retry_files_enabled = True
retry_files_save_path = tmp/retry
max_diff_size = 104448
system_warnings = True
# deprecation_warnings = True  # REMOVED: Duplicate - already set to False above
command_warnings = True
localhost_warning = True
invalid_task_attribute_failed = True

# ============================================================================
# DEVELOPMENT AND TESTING SUPPORT
# ============================================================================
# Diff and check mode settings
diff_always = False
diff_context = 3
check_mode_markers = True

# Debugging and verbosity
debug = False
verbose = False
enable_task_debugger = False

# ============================================================================
# PATHS AND COLLECTIONS
# ============================================================================
# Role and collection paths
roles_path = roles:~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles
collections_paths = collections:~/.ansible/collections:/usr/share/ansible/collections
collections_scan_sys_path = True

# Plugin paths
action_plugins = ~/.ansible/plugins/action:/usr/share/ansible/plugins/action
become_plugins = ~/.ansible/plugins/become:/usr/share/ansible/plugins/become
cache_plugins = ~/.ansible/plugins/cache:/usr/share/ansible/plugins/cache
callback_plugins = ~/.ansible/plugins/callback:/usr/share/ansible/plugins/callback
connection_plugins = ~/.ansible/plugins/connection:/usr/share/ansible/plugins/connection
filter_plugins = ~/.ansible/plugins/filter:/usr/share/ansible/plugins/filter
inventory_plugins = ~/.ansible/plugins/inventory:/usr/share/ansible/plugins/inventory
lookup_plugins = ~/.ansible/plugins/lookup:/usr/share/ansible/plugins/lookup
vars_plugins = ~/.ansible/plugins/vars:/usr/share/ansible/plugins/vars

# ============================================================================
# SSH CONNECTION OPTIMIZATION
# ============================================================================
[ssh_connection]
# SSH performance optimization
ssh_args = -o ControlMaster=auto -o ControlPersist=300s -o IdentitiesOnly=yes -o ServerAliveInterval=30 -o ServerAliveCountMax=5 -o ConnectTimeout=10 -o BatchMode=yes
control_path_dir = ~/.ansible/cp
control_path = %(control_path_dir)s/%%h-%%p-%%r
pipelining = True
scp_if_ssh = smart
transfer_method = smart
retries = 3

# SSH connection settings for dev-test.hana-x.ai domain
ssh_executable = /usr/bin/ssh
scp_executable = /usr/bin/scp
sftp_executable = /usr/bin/sftp
# ssh_common_args = -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  # REMOVED: Security bypass

# ============================================================================
# PRIVILEGE ESCALATION
# ============================================================================
[privilege_escalation]
become = True
become_method = sudo
become_user = root
become_exe = sudo
become_flags = -H -S -n
become_ask_pass = False
become_allow_same_user = False

# ============================================================================
# INVENTORY CONFIGURATION
# ============================================================================
[inventory]
# Inventory plugin configuration
enable_plugins = host_list,script,auto,yaml,ini,toml,constructed,advanced_host_list
cache = True
cache_plugin = jsonfile
cache_timeout = 3600
cache_connection = tmp/ansible_inventory_cache
ignore_extensions = .pyc,.pyo,.swp,.bak,~,.rpm,.md,.txt,.rst
ignore_patterns = artifacts,credentials
unparsed_is_failed = True

# ============================================================================
# PERSISTENT CONNECTION
# ============================================================================
[persistent_connection]
# Network device connection settings
connect_timeout = 30
connect_retry_timeout = 15
connect_interval = 1
command_timeout = 30

# ============================================================================
# PARAMIKO CONNECTION (fallback)
# ============================================================================
[paramiko_connection]
# Paramiko-specific settings for older systems
# record_host_keys = False  # REMOVED: Security risk
pty = True
# look_for_keys = True  # REMOVED: Deprecated - moved to plugin
# host_key_auto_add = True  # REMOVED: Deprecated - moved to plugin

# ============================================================================
# GALAXY CONFIGURATION
# ============================================================================
[galaxy]
# Ansible Galaxy settings
server_list = automation_hub,galaxy
cache_dir = tmp/ansible_galaxy_cache
role_skeleton_ignore = ^.git$,^.*/.git_keep$

[galaxy_server.automation_hub]
url = https://console.redhat.com/api/automation-hub/
auth_url = https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token

[galaxy_server.galaxy]
url = https://galaxy.ansible.com/

# ============================================================================
# NETCONF CONNECTION
# ============================================================================
[netconf_connection]
# Network configuration management
ssh_config = True
network_os = auto

# ============================================================================
# SELINUX CONFIGURATION
# ============================================================================
[selinux]
# SELinux settings for security compliance
special_context_filesystems = fuse,nfs,vboxsf,ramfs,9p,vfat
# libvirt_lxc_noseclabel = True  # REMOVED: Deprecated - moved to plugin

# ============================================================================
# COLORS AND DISPLAY
# ============================================================================
[colors]
# Output colorization
highlight = white
verbose = blue
warn = bright purple
error = red
debug = dark gray
deprecate = purple
skip = cyan
unreachable = red
ok = green
changed = yellow
diff_add = green
diff_remove = red
diff_lines = cyan

# ============================================================================
# DIFF CONFIGURATION
# ============================================================================
[diff]
# Diff output settings
always = False
context = 3

# ============================================================================
# ENHANCED SECURITY CONFIGURATION
# ============================================================================
[ssh_connection]
# Enhanced cipher suites - remove CBC ciphers, add modern alternatives
ssh_args = -o ControlMaster=auto -o ControlPersist=300s -o IdentitiesOnly=yes -o ServerAliveInterval=30 -o ServerAliveCountMax=5 -o ConnectTimeout=10 -o BatchMode=yes -o Ciphers=chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr -o MACs=hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha2-512 -o KexAlgorithms=curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group14-sha256

